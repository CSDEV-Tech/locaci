// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id             String   @id @default(uuid()) @db.Uuid
    firstName      String?
    lastName       String?
    phoneNumber    String?
    email          String   @unique
    role           Role     @default(HOUSING_APPLICANT)
    createdAt      DateTime @default(now())
    updatedAt      DateTime @updatedAt
    email_verified Boolean  @default(false)
    civicTitle     Civility @default(MR)

    properties       Property[] // A user can have many properties
    RequestOwnerRole RequestOwnerRole?
}

enum Role {
    HOUSING_APPLICANT
    PROPERTY_OWNER
    ADMIN
}

enum Civility {
    MR
    MME
}

model RequestOwnerRole {
    id                String        @id @default(uuid()) @db.Uuid
    validatedAt       DateTime?
    status            RequestStatus @default(WAITING)
    createdAt         DateTime      @default(now())
    updatedAt         DateTime      @updatedAt
    reasonForRefusing String?

    user   User   @relation(fields: [userId], references: [id])
    userId String @unique @db.Uuid
}

enum RequestStatus {
    WAITING
    GRANTED
    REFUSED
}

model Room {
    id         String   @id @default(uuid()) @db.Uuid
    type       RoomType @default(BEDROOM)
    Property   Property @relation(fields: [propertyId], references: [id])
    propertyId String   @db.Uuid
}

enum RoomType {
    BEDROOM
    LIVING_ROOM
    KITCHEN
    BATHROOM
    LAUNDRY
    TOILET
    ATTIC
    BASEMENT
    DINING_ROOM
    GARAGE
    BALCONY
    VERANDA
    TERRACE
}

enum AmenityType {
    WIFI
    CABLE
    HOT_WATER
    TWIN_BED
    RADIATOR
    OTHER
}

model Amenity {
    id   String      @id @default(uuid()) @db.Uuid
    type AmenityType
    name String?
}

model Image {
    id         String    @id @default(uuid()) @db.Uuid
    uri        String
    Property   Property? @relation(fields: [propertyId], references: [id])
    propertyId String?   @db.Uuid
}

model Property {
    id        String   @id @default(uuid()) @db.Uuid
    rentType  RentType @default(LOCATION)
    userId    String   @db.Uuid
    owner     User     @relation(fields: [userId], references: [id]) // A Property have one owner
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    archived  Boolean  @default(false)
    noOfRooms Int
    rooms     Room[]
    images    Image[]

    surfaceArea  Int
    city         City         @relation(fields: [cityId], references: [id])
    commune      Municipality @relation(fields: [municipalityId], references: [id])
    locality     Locality?    @relation(fields: [localityId], references: [id])
    localityName String

    // Position
    longitude String
    latitude  String

    // position limits
    geoData        Json
    cityId         String  @db.Uuid
    municipalityId String  @db.Uuid
    localityId     String? @db.Uuid
}

enum RentType {
    LOCATION
    SHARED_APPARTMENT
    SHORT_TERM
}

model City {
    id             String         @id @default(uuid()) @db.Uuid
    name           String
    municipalities Municipality[]
    Property       Property[]
}

// Commune
model Municipality {
    id         String     @id @default(uuid()) @db.Uuid
    name       String
    city       City       @relation(fields: [cityId], references: [id])
    cityId     String     @db.Uuid
    localities Locality[]
    Property   Property[]
}

// Quartier
model Locality {
    id             String       @id @default(uuid()) @db.Uuid
    name           String
    municipality   Municipality @relation(fields: [municipalityId], references: [id])
    municipalityId String       @db.Uuid
    Property       Property[]
}
